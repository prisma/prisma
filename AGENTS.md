# Refract Agents Quick Guide

- Monorepo (pnpm workspaces) under /packages; key areas: client, client-generator-ts/js, cli, internals, migrate, engines (legacy), fetch-engine, get-platform, ts-builders.
- Core concepts: DMMF JSON AST and a TypeScript-native engine replacing Rust; functional tests live in [packages/client/tests/functional](file:///Users/jharrell/code/refract/packages/client/tests/functional).
- Build: `pnpm install` â†’ `pnpm build` (or `pnpm watch`).
- Lint/format: `pnpm lint`, `pnpm lint-fix`, `pnpm format`, `pnpm prettier-check`.
- Tests (root): `pnpm test` runs the suite; `pnpm test <pattern>` runs matching files; `pnpm test <pattern> -t '<name>'` a single test; add `-u` to update snapshots.
- DB setup required for tests: see [docker/README.md](file:///Users/jharrell/code/refract/docker/README.md); `.db.env` is auto-loaded by the root test script.
- Scripts reference: see [package.json scripts](file:///Users/jharrell/code/refract/package.json#L11-L31).
- Prettier: 2-space, singleQuote, no semicolons, trailingComma=all, printWidth=120 (see [.prettierrc.yml](file:///Users/jharrell/code/refract/.prettierrc.yml#L1-L5)).
- ESLint highlights: sorted imports and exports, newline after imports, no duplicates, error on unused vars but ignore args starting with `_` (see [eslint rules](file:///Users/jharrell/code/refract/eslint.config.cjs#L147-L151) and [unused vars](file:///Users/jharrell/code/refract/eslint.config.cjs#L114-L121)).
- TypeScript/Modules: ESM-only; prefer explicit types on public surfaces; avoid `any` unless required by upstream types.
- Imports/exports: deterministic sorted groups (std/third-party/internal), prefer named exports; default export only for configs when necessary.
- Error handling: fail fast with early returns; include context in thrown errors; avoid console output in libraries; surface predictable error types.
- Testing style: prefer functional tests; each has `_matrix.ts`, `prisma/_schema.ts`, `tests.ts` in the test folder.
- Cursor rules: see [.cursor/rules/cursor_rules.mdc](file:///Users/jharrell/code/refract/.cursor/rules/cursor_rules.mdc), [.cursor/rules/self_improve.mdc](file:///Users/jharrell/code/refract/.cursor/rules/self_improve.mdc), and TaskMaster rules under [.cursor/rules/taskmaster](file:///Users/jharrell/code/refract/.cursor/rules/taskmaster).
- Claude rules: see [CLAUDE.md](file:///Users/jharrell/code/refract/CLAUDE.md) and [CLAUDE.local.md](file:///Users/jharrell/code/refract/CLAUDE.local.md).
- Conventions: small, cohesive diffs; reuse existing patterns/APIs; no new dependencies without approval; match adjacent code.
- Engines: legacy Prisma engines remain for compatibility; TS-native engine work is ongoing; see package READMEs/commits.
- Useful refs: [eslint.config.cjs](file:///Users/jharrell/code/refract/eslint.config.cjs), [.prettierrc.yml](file:///Users/jharrell/code/refract/.prettierrc.yml), [ARCHITECTURE.md](file:///Users/jharrell/code/refract/ARCHITECTURE.md).
- Prefer `pnpm -r` for workspace-wide commands; when running a single package script, `cd` into that package or use `-r --filter <pkg>`.
