steps:
  - label: ':coverage: Test %n - Node 14 (Search for `BUILDKITE_PARALLEL_JOB` in test output for definition what is being tested)'
    parallelism: 2
    timeout_in_minutes: 35
    plugins:
      - docker-compose#v3.9.0:
          config: .buildkite/test/docker-compose.14.yml
          run: app
  - label: 'Client functional tests, Node 14, engine={{ matrix.engine }}, provider={{ matrix.provider }}'
    commands:
      - pnpm install --frozen-lockfile
      - pnpm build
      - pnpm run --filter "@prisma/client" test:functional -- -p {{ matrix.provider}}
    env:
      PRISMA_CLIENT_ENGINE_TYPE: '{{ matrix.engine }}'
    timeout_in_minutes: 35
    matrix:
      setup:
        engine:
          - binary
          - library
        provider:
          - sqlite
          - postgresql
          - mysql
          - mongodb
          - cockroachdb
          - sqlserver
    plugins:
      - docker-compose#v3.9.0:
          config: .buildkite/test/docker-compose.14.yml
          run: app

  - wait
